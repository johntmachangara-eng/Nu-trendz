<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Nu-Trendz | Booking</title>

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap"
    rel="stylesheet"
  >
  <link
    rel="stylesheet"
    href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined"
  >

  <!-- Styles -->
  <link rel="stylesheet" href="footer.css" />
  <link rel="stylesheet" href="booking.css" />

  <style>
    body {
      font-family: "Poppins", system-ui, sans-serif;
      margin: 0;
    }
  </style>

  <!-- üî• Firebase v8 (global firebase object) -->
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-analytics.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

  <!-- ‚úâÔ∏è EmailJS (optional ‚Äì only if you want email confirmations) -->
  <script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyBshg3uKI9UK043ItARQhPf4kw4fDqDnkc",
      authDomain: "database-93ee7.firebaseapp.com",
      projectId: "database-93ee7",
      storageBucket: "database-93ee7-firebasestorage.app",
      messagingSenderId: "512064197430",
      appId: "1:512064197430:web:62ca518c67d20f82001997",
      measurementId: "G-Z3MPD1RWMD",
      databaseURL: "https://database-93ee7-default-rtdb.europe-west1.firebasedatabase.app"
    };

    if (!firebase.apps.length) {
      firebase.initializeApp(firebaseConfig);
      try {
        firebase.analytics();
      } catch (e) {
        console.warn("Analytics not configured (ok to ignore):", e);
      }
    }
    window.rtdb = firebase.database();
    if (window.emailjs) {
      emailjs.init("Lgg9FCMDk-lwWnNxZ");
    }
  </script>
</head>

<body>
  <main id="booking-page">
    <!-- HEADER + STEPS -->
    <section class="booking-header">
      <h1>Book <span>Your Appointment</span></h1>
      <p>Follow the steps below to choose your services, time and details.</p>

      <section class="steps-strip" aria-label="Booking steps">
        <div class="step step--active" data-step="1" role="button" tabindex="0">
          <span>1</span><p>Services &amp; stylists</p>
        </div>
        <div class="step" data-step="2" role="button" tabindex="0">
          <span>2</span><p>Date &amp; time</p>
        </div>
        <div class="step" data-step="3" role="button" tabindex="0">
          <span>3</span><p>Your details</p>
        </div>
      </section>
    </section>

    <!-- ========== STEP 1: SUMMARY + STYLISTS ========== -->
    <section class="booking-step" data-step-panel="1">
      <div class="booking-layout">
        <!-- LEFT: SERVICES SUMMARY -->
        <section class="booking-card">
          <h2>Your services</h2>
          <div id="servicesSummary"></div>

          <div class="booking-total-row">
            <p>
              <span id="summaryTotalLabel">Estimated total:</span>
              <span id="summaryTotal">¬£0</span>
            </p>
          </div>

          <p class="small-note">
            These services come from your basket. If you want to change them, go back to the Services page.
          </p>

          <div class="step-buttons">
            <a href="services.html" class="secondary-btn" id="changeServicesBtn">
              ‚Üê Change services
            </a>
          </div>
        </section>

        <!-- RIGHT: STYLISTS -->
        <section class="booking-card">
          <h2>Choose your stylist</h2>
          <p class="booking-help">
            You can use <strong>one stylist</strong> for all services, or choose
            a stylist for each service separately.
          </p>

          <div class="stylist-mode">
            <label>
              <input type="radio" name="stylistMode" value="one" checked>
              Use <strong>one stylist</strong> for all services
            </label>
            <label>
              <input type="radio" name="stylistMode" value="per-service">
              Choose a stylist <strong>for each service</strong>
            </label>
          </div>

          <div id="stylistGlobalSelectWrapper" class="form-group">
            <label for="stylistAll">Stylist for all services</label>
            <select id="stylistAll"></select>
          </div>

          <div
            id="stylistPerServiceWrapper"
            class="per-service-stylists hidden"
          ></div>

          <div class="step-buttons">
            <button type="button" id="toStep2" class="primary-btn">
              Next: Choose date &amp; time
            </button>
          </div>

          <p id="step1Error" class="step-error" aria-live="polite"></p>
        </section>
      </div>
    </section>

    <!-- ========== STEP 2: DATE & TIME ========== -->
    <section class="booking-step hidden" data-step-panel="2">
      <div class="booking-layout single-column">
        <section class="booking-card">
          <h2>Date &amp; time</h2>
          <p class="booking-help">
            Pick a date and time that works for you. The salon is open from
            <strong>09:00</strong> to <strong>18:30</strong>.
          </p>

          <!-- Date + popup calendar trigger -->
          <div class="form-group">
            <label for="bookingDateButton">Choose a date</label>

            <button
              type="button"
              id="bookingDateButton"
              class="date-button"
              aria-haspopup="dialog"
              aria-expanded="false"
            >
              <span class="material-symbols-outlined calendar-icon">
                calendar_month
              </span>
              <span id="bookingDateLabel">Select a date</span>
            </button>

            <!-- Hidden native input (for min/max and data only) -->
            <input type="date" id="bookingDate" class="hidden-date-input">

            <p id="dateStatus" class="small-note" aria-live="polite"></p>
          </div>

          <div class="form-group">
            <label>Available times</label>
            <div id="timeSlots" class="time-slots">
              <!-- time-slot buttons injected by JS -->
            </div>
          </div>

          <div class="step-buttons">
            <button type="button" class="secondary-btn" id="backTo1">
              ‚Üê Back
            </button>
            <button type="button" class="primary-btn" id="toStep3">
              Next: Your details
            </button>
          </div>
        </section>
      </div>
    </section>

    <!-- ========== STEP 3: YOUR DETAILS ========== -->
    <section class="booking-step hidden" data-step-panel="3">
      <div class="booking-layout">
        <!-- LEFT: FORM -->
        <section class="booking-card">
          <h2>Your details</h2>
          <p class="booking-help">
            Tell us who the booking is for and how to contact you.
          </p>

          <form id="detailsForm" novalidate>
            <div class="form-row">
              <div class="form-group">
                <label for="firstName">First name</label>
                <input
                  type="text"
                  id="firstName"
                  placeholder="First name"
                  autocomplete="given-name"
                  required
                >
              </div>

              <div class="form-group">
                <label for="lastName">Last name</label>
                <input
                  type="text"
                  id="lastName"
                  placeholder="Last name"
                  autocomplete="family-name"
                  required
                >
              </div>
            </div>

            <input
              type="hidden"
              id="fullName"
              autocomplete="name"
            >

            <div class="form-group">
              <label for="email">Email address</label>
              <input
                type="email"
                id="email"
                placeholder="you@example.com"
                autocomplete="email"
                required
              >
            </div>

            <div class="form-group">
              <label for="phone">Mobile number</label>
              <input
                type="tel"
                id="phone"
                placeholder="07..."
                autocomplete="tel"
                required
              >
            </div>

            <div class="form-group">
              <label for="notes">Extra notes (optional)</label>
              <textarea
                id="notes"
                rows="4"
                placeholder="Hair length, past styles, allergies, anything we should know."
              ></textarea>
            </div>

            <h3 class="subheading">How would you like to pay?</h3>
            <div class="payment-options">
              <label>
                <input
                  type="radio"
                  name="paymentMethod"
                  value="pay_at_venue"
                  checked
                >
                Pay at the salon
              </label>
              <label>
                <input
                  type="radio"
                  name="paymentMethod"
                  value="pay_later"
                >
                Decide payment later (we will contact you)
              </label>
            </div>

            <p class="small-warning">
              This page <strong>only saves your booking</strong> and payment choice.
              Card payments are handled separately by the salon.
            </p>

            <div class="step-buttons">
              <button type="button" class="secondary-btn" id="backTo2">
                ‚Üê Back
              </button>
              <button type="submit" class="primary-btn">
                Confirm booking
              </button>
            </div>

            <p id="finalStatus" class="step-error" aria-live="polite"></p>
          </form>
        </section>

        <!-- RIGHT: FINAL SUMMARY -->
        <section class="booking-card">
          <h2>Summary</h2>
          <div id="finalSummary"></div>

          <div class="booking-total-row">
            <p>
              <span id="finalTotalLabel">Estimated total:</span>
              <span id="finalTotal">¬£0</span>
            </p>
          </div>

          <p class="small-note">
            Times and availability are checked against existing bookings in our system.
          </p>

          <ul class="small-note">
            <li>We‚Äôll also send a confirmation email (if email is working).</li>
            <li>If you need to change anything, contact Nu-Trendz directly.</li>
          </ul>

          <a href="index.html" class="back-link">‚Üê Back to home</a>
        </section>
      </div>
    </section>
  </main>

  <!-- POPUP CALENDAR (overlays page like a normal calendar) -->
  <div
    id="bookingCalendar"
    class="booking-calendar"
    aria-hidden="true"
  >
    <div
      class="calendar-inner"
      role="dialog"
      aria-modal="true"
      aria-label="Select a date"
    >
      <div class="calendar-header">
        <button
          type="button"
          id="calendarPrev"
          class="calendar-nav"
          aria-label="Previous month"
        >
          ‚Äπ
        </button>
        <span id="calendarMonthLabel" class="calendar-month-label"></span>
        <button
          type="button"
          id="calendarNext"
          class="calendar-nav"
          aria-label="Next month"
        >
          ‚Ä∫
        </button>
      </div>

      <div class="calendar-grid">
        <div class="calendar-row calendar-row--header">
          <span>Mon</span>
          <span>Tue</span>
          <span>Wed</span>
          <span>Thu</span>
          <span>Fri</span>
          <span>Sat</span>
          <span>Sun</span>
        </div>
        <div id="calendarDays" class="calendar-days">
          <!-- days injected by booking.js -->
        </div>
      </div>

      <button
        type="button"
        id="calendarClose"
        class="secondary-btn calendar-close-btn"
      >
        Close
      </button>
    </div>
  </div>

  <!-- FOOTER -->
  <footer class="site-footer">
    <div class="footer-bottom">
      <p>&copy; 2025 NU-TRENDZ. All Rights Reserved.</p>
    </div>
  </footer>

  <script src="booking.js"></script>
</body>
</html>
